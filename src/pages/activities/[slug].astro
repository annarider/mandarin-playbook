---
import { getCollection } from 'astro:content';
import VocabCard from '../../components/VocabCard.astro';
import PhrasesCard from '../../components/PhrasesCard.astro';
import SuppliesCard from '../../components/SuppliesCard.astro';
import InstructionsCard from '../../components/InstructionsCard.astro';
import TipsCard from '../../components/TipsCard.astro';
import MobileSwiper from '../../components/MobileSwiper.astro';

export async function getStaticPaths() {
  const activities = await getCollection('activities');
  return activities.map((activity) => ({
    params: { slug: activity.slug },
    props: { activity },
  }));
}

const { activity } = Astro.props;
const { Content } = await activity.render();

// Prepare cards for mobile swiper
const swiperCards = [];
if (activity.data.vocabulary) {
  swiperCards.push({ type: 'vocab' as const, content: activity.data.vocabulary });
}
if (activity.data.phrases) {
  swiperCards.push({ type: 'phrases' as const, content: activity.data.phrases });
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{activity.data.title} - Mandarin Homeschool Activities</title>
		<style>
			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
				line-height: 1.6;
				color: #333;
				background: #f9fafb;
				padding: 1rem;
			}

			.back-nav {
				margin-bottom: 1.5rem;
			}

			.back-nav a {
				color: #c41e3a;
				text-decoration: none;
				font-size: 1rem;
				font-weight: 500;
			}

			.back-nav a:hover {
				text-decoration: underline;
			}

			.activity-header {
				margin-bottom: 2rem;
			}

			h1 {
				font-size: 2rem;
				color: #c41e3a;
				margin-bottom: 0.75rem;
			}

			.description {
				font-size: 1.25rem;
				color: #555;
				margin-bottom: 1rem;
			}

			.metadata {
				display: flex;
				flex-wrap: wrap;
				gap: 1rem;
				font-size: 0.95rem;
			}

			.meta-item {
				background: #fff;
				padding: 0.5rem 1rem;
				border-radius: 8px;
				border: 1px solid #e5e7eb;
			}

			.meta-item strong {
				color: #c41e3a;
				margin-right: 0.25rem;
			}

			.activity-content {
				max-width: 100%;
			}

			.tags-section {
				background: #f3f4f6;
				padding: 1rem;
				border-radius: 8px;
				margin-top: 1.5rem;
				font-size: 0.95rem;
			}

			.tags-section strong {
				color: #c41e3a;
				margin-right: 0.5rem;
			}

			.printable.card {
				border: 2px solid #333;
				border-radius: 12px;
				padding: 1.5rem;
				margin-bottom: 1.5rem;
				background: #fff;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			}

			.printable h2 {
				margin-top: 0;
				margin-bottom: 1rem;
				font-size: 1.5rem;
				color: #c41e3a;
				border-bottom: 2px solid #c41e3a;
				padding-bottom: 0.5rem;
			}

			.printable p {
				margin: 0;
				font-size: 1.125rem;
			}

			.printable a {
				color: #c41e3a;
				text-decoration: none;
				font-weight: 500;
			}

			.printable a:hover {
				text-decoration: underline;
			}

			/* Mobile/Desktop visibility toggles */
			.mobile-only {
				display: block;
			}

			.desktop-only {
				display: none;
			}

			@media (min-width: 768px) {
				.mobile-only {
					display: none;
				}

				.desktop-only {
					display: block;
				}
				body {
					padding: 2rem;
					max-width: 900px;
					margin: 0 auto;
				}

				h1 {
					font-size: 2.5rem;
				}

				.description {
					font-size: 1.375rem;
				}

				.metadata {
					font-size: 1rem;
				}

				.back-nav a {
					font-size: 1.125rem;
				}

				.tags-section {
					font-size: 1rem;
				}

				.printable.card {
					padding: 2rem;
				}

				.printable h2 {
					font-size: 1.75rem;
				}

				.printable p {
					font-size: 1.25rem;
				}
			}
		</style>
	</head>
	<body>
		<nav class="back-nav">
			<a href="/">← Back to all activities</a>
		</nav>

		<header class="activity-header">
			<h1>{activity.data.title}</h1>
			<p class="description">{activity.data.description}</p>
			<div class="metadata">
				<span class="meta-item"><strong>Age:</strong> {activity.data.ageRange}</span>
				<span class="meta-item"><strong>Duration:</strong> {activity.data.duration}</span>
				<span class="meta-item"><strong>Level:</strong> {activity.data.difficultyLevel}</span>
			</div>
		</header>

		<main class="activity-content">
			<!-- Mobile: Show swiper for vocab/phrases cards -->
			{swiperCards.length > 0 && (
				<div class="mobile-only">
					<MobileSwiper cards={swiperCards} client:load />
				</div>
			)}

			<!-- Desktop: Show all cards stacked -->
			<div class="desktop-only">
				{activity.data.vocabulary && <VocabCard items={activity.data.vocabulary} />}
				{activity.data.phrases && <PhrasesCard items={activity.data.phrases} />}
			</div>

			{activity.data.supplies && <SuppliesCard items={activity.data.supplies} />}

			{activity.data.printable && (
				<div class="printable card">
					<h2>Printable</h2>
					<p>
						<a href={activity.data.printable.url} target="_blank">
							Download: {activity.data.printable.title}
						</a>
					</p>
				</div>
			)}

			<InstructionsCard Content={Content} />

			<TipsCard tips={activity.data.tips} />

			{activity.data.tags && (
				<div class="tags-section">
					<strong>Tags:</strong> {activity.data.tags.join(', ')}
				</div>
			)}
		</main>

		<nav class="back-nav">
			<a href="/">← Back to all activities</a>
		</nav>
	</body>
</html>
